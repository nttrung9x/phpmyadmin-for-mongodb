#######
# PhpMongoAdmin - Web based MongoDB management written in php using Vue & Laravel
#
# WARNING !! PUBLIC ACCESS ENABLED !!
#
# Allowing PhpMongoAdmin to anyone other than localhost should be considered
# dangerous unless properly secured by SSL

#######
# This configuration is meant for creating a Virtual Host implementation
# It is NOT meant to be used for creating a Global install: http://my.ebdomain.com/phpmongoadmin
# For a Global setup use the: setup/apache/global/phpMongoAdmin.conf sample configutation
#
#   Setting up a VirtualHost is not yet supported via a shell script
#
#######

#######
# Creating a Virtual Host installtion requires some planning, due to the many possible location for the application code
# This virtualhost configuration makes the assumption that the default apache web root will be used
# Using this configuration requires the application base to be installed at: /var/www
# Here are some viable alternative web root locations:
# - /var/hosting/sites/phpMongoAdmin
# - /home/< user >/phpMongoAdmin
#######
<Directory /usr/share/phpMongoAdmin/public/>
    # Engine is required
    RewriteEngine On

    #######
    #  If you want to use a different URI path make sure you change this and the Redirect above to match
    #######
    RewriteBase "/"

    # Handle Authorization Header
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Redirect Trailing Slashes If Not A Folder...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [L,R=301]

    # Send Requests To Front Controller...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [L]

    AddDefaultCharset UTF-8
    #AllowOverride All
    Options FollowSymLinks

    #######
    # In order to expose your install to the wild: add a public IP address
    #######
    <IfModule mod_authz_core.c>
        # Apache 2.4
        <RequireAny>
            # public access
            Require all granted
        </RequireAny>
    </IfModule>
    <IfModule !mod_authz_core.c>
        # Apache 2.2
        Order Deny,Allow
        Deny from All
        # public access
        Allow from all
    </IfModule>

</Directory>

# All these directories do not require access over HTTP - best to lock them down to be safe
<Directory /usr/share/phpMongoAdmin/app>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

<Directory /usr/share/phpMongoAdmin/bootstrap>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

<Directory /usr/share/phpMongoAdmin/config>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

<Directory /usr/share/phpMongoAdmin/database>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

<Directory /usr/share/phpMongoAdmin/resources>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

<Directory /usr/share/phpMongoAdmin/routes>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

<Directory /usr/share/phpMongoAdmin/setup>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

<Directory /usr/share/phpMongoAdmin/storage>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

<Directory /usr/share/phpMongoAdmin/tests>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

<Directory /usr/share/phpMongoAdmin/vendor>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>
